<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleyball Rotation Visual</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        
        .court-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }
        
        .net-line {
            background: #f39c12;
            color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .court {
            display: grid;
            grid-template-columns: repeat(3, 120px);
            grid-template-rows: repeat(2, 120px);
            gap: 15px;
            border: 4px solid #e74c3c;
            padding: 20px;
            background: #2ecc71;
            border-radius: 10px;
        }
        
        .position {
            width: 120px;
            height: 120px;
            border: 3px solid #34495e;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .position:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .position-number {
            font-weight: bold;
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 5px;
        }
        
        .player-name {
            font-size: 16px;
            color: #2c3e50;
            font-weight: bold;
            text-align: center;
        }
        
        .player-gender {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 2px;
        }
        
        .court-labels {
            text-align: center;
            margin: 10px 0;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .queues {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .queue {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .queue-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
        }
        
        .queue-player {
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .queue-player:hover {
            border-color: #3498db;
            transform: scale(1.05);
        }
        
        .queue-player.next {
            /* No red border or background, just bold for distinction */
            border-color: #bdc3c7;
            background: white;
            font-weight: bold;
        }
        
        .rotation-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }
        
        .rotation-step {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .arrow {
            color: #e74c3c;
            font-weight: bold;
            font-size: 18px;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .rotation-counter {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
        }

        /* Added .secondary style for secondary buttons */
        .btn.secondary {
            background: #95a5a6;
            color: #fff;
        }
        .btn.secondary:hover {
            background: #7f8c8d;
        }

        .player-management {
            max-width: 500px;
            margin: 0 auto 40px auto;
            padding: 0 10px;
        }

        .management-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 350px;
        }

        .player-list {
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
        }

        @media (min-width: 600px) {
            .input-group {
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
            .player-list {
                max-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Volleyball Court Rotation System</div>

        <!-- Move controls here -->
        <div class="controls">
            <button class="btn" onclick="rotateOnce()">Rotate Once</button>
            <button class="btn" onclick="reset()">Reset</button>
            <button class="btn" onclick="autoRotate()" id="autoBtn">Auto Rotate</button>
        </div>

        <div class="rotation-counter">
            Rotation: <span id="rotationCount">0</span>
        </div>
        
        <div class="court-container">
            <div class="net-line">NET LINE</div>
            
            <div class="court">
                <!-- Front row (near net): positions 1, 2, 3 -->
                <div class="position" id="pos1">
                    <div class="position-number">1</div>
                    <div class="player-name" id="player1">Alex</div>
                    <div class="player-gender">M</div>
                </div>
                <div class="position" id="pos2">
                    <div class="position-number">2</div>
                    <div class="player-name" id="player2">Edie</div>
                    <div class="player-gender">F</div>
                </div>
                <div class="position" id="pos3">
                    <div class="position-number">3</div>
                    <div class="player-name" id="player3">David</div>
                    <div class="player-gender">M</div>
                </div>
                
                <!-- Back row (away from net): positions 6, 5, 4 -->
                <div class="position" id="pos6">
                    <div class="position-number">6</div>
                    <div class="player-name" id="player6">Bridget</div>
                    <div class="player-gender">F</div>
                </div>
                <div class="position" id="pos5">
                    <div class="position-number">5</div>
                    <div class="player-name" id="player5">Vishesh</div>
                    <div class="player-gender">M</div>
                </div>
                <div class="position" id="pos4">
                    <div class="position-number">4</div>
                    <div class="player-name" id="player4">Abby</div>
                    <div class="player-gender">F</div>
                </div>
            </div>
            
            <div class="court-labels">
                Front Row: 1, 2, 3 | Back Row: 6, 5, 4
            </div>
        </div>
        
        <div class="queues">
            <div class="queue">
                <div class="queue-title">Male Queue</div>
                <div id="maleQueue">
                    <!-- JS will populate -->
                </div>
            </div>
            <div class="queue">
                <div class="queue-title">Female Queue</div>
                <div id="femaleQueue">
                    <!-- JS will populate -->
                </div>
            </div>
        </div>
        
        <div class="player-management">
            <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Player Management</h3>
            
            <div class="management-section">
                <h4 style="color: #2c3e50;">Add New Player</h4>
                <div class="input-group">
                    <input type="text" id="newPlayerName" placeholder="Enter player name" maxlength="20">
                    <select id="newPlayerGender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                    <button class="btn" onclick="addPlayer()">Add Player</button>
                </div>
            </div>
            
            <div class="management-section">
                <h4 style="color: #2c3e50;">Current Players</h4>
                <div class="player-list" id="playerList">
                    <!-- Players will be populated here -->
                </div>
            </div>
        </div>
        
        <div class="rotation-info">
            <div class="rotation-step">
                <strong>Volleyball Rotation Process:</strong>
            </div>
            <div class="rotation-step">
                1. Player at position 6 (back left) exits <span class="arrow">→</span> goes to back of their queue
            </div>
            <div class="rotation-step">
                2. All players shift clockwise: 1→2, 2→3, 3→4, 4→5, 5→6
            </div>
            <div class="rotation-step">
                3. Next player from queue enters at position 1 (front left)
            </div>
            <div class="rotation-step">
                <strong>Layout:</strong> Front row (1,2,3) near net | Back row (6,5,4) away from net
            </div>
        </div>
        
        <div id="rotationLog" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        // Simple approach: just track all players and who's on court
        let allMales = ['Alex', 'David', 'Vishesh', 'Ben', 'Ross', 'Sam'];
        let allFemales = ['Bridget', 'Edie', 'Abby', 'Tonya'];
        
        // Fair rotation orders
        let maleRotationOrder = ['Sam', 'Alex', 'Vishesh', 'David', 'Ross', 'Ben'];
        let femaleRotationOrder = ['Bridget', 'Edie', 'Abby', 'Tonya'];
        
        // Instead of using rotationOrder and index, use explicit queues:
        let maleQueue = ['Sam', 'Alex', 'Vishesh', 'David', 'Ross', 'Ben'].filter(name => !['Alex', 'David', 'Vishesh'].includes(name));
        let femaleQueue = ['Bridget', 'Edie', 'Abby', 'Tonya'].filter(name => !['Bridget', 'Edie', 'Abby'].includes(name));
        
        // Initial court: 3 males, 3 females
        let court = ['Alex', 'Edie', 'David', 'Abby', 'Vishesh', 'Bridget']; // positions 1-6
        let rotationCount = 0;
        let autoRotateInterval = null;
        
        function updateDisplay() {
            // Update court positions
            for (let i = 0; i < 6; i++) {
                const player = court[i];
                if (!player) {
                    document.getElementById(`player${i + 1}`).textContent = 'Empty';
                    document.getElementById(`pos${i + 1}`).querySelector('.player-gender').textContent = '';
                } else {
                    const gender = allMales.includes(player) ? 'M' : 'F';
                    document.getElementById(`player${i + 1}`).textContent = player;
                    document.getElementById(`pos${i + 1}`).querySelector('.player-gender').textContent = gender;
                }
            }
            
            // Update male queue
            const maleQueueDiv = document.getElementById('maleQueue');
            maleQueueDiv.innerHTML = '';
            if (maleQueue.length === 0) {
                const div = document.createElement('div');
                div.className = 'queue-player';
                div.textContent = 'No males waiting';
                div.style.fontStyle = 'italic';
                div.style.color = '#7f8c8d';
                maleQueueDiv.appendChild(div);
            } else {
                maleQueue.forEach((name, idx) => {
                    const div = document.createElement('div');
                    div.className = 'queue-player' + (idx === 0 ? ' next' : '');
                    div.textContent = name;
                    maleQueueDiv.appendChild(div);
                });
            }
            
            // Update female queue
            const femaleQueueDiv = document.getElementById('femaleQueue');
            femaleQueueDiv.innerHTML = '';
            if (femaleQueue.length === 0) {
                const div = document.createElement('div');
                div.className = 'queue-player';
                div.textContent = 'No females waiting';
                div.style.fontStyle = 'italic';
                div.style.color = '#7f8c8d';
                femaleQueueDiv.appendChild(div);
            } else {
                femaleQueue.forEach((name, idx) => {
                    const div = document.createElement('div');
                    div.className = 'queue-player' + (idx === 0 ? ' next' : '');
                    div.textContent = name;
                    femaleQueueDiv.appendChild(div);
                });
            }
            
            // Update rotation count
            document.getElementById('rotationCount').textContent = rotationCount;
        }
        
        function rotateOnce() {
            const exitingPlayer = court[5]; // position 6 exits

            // Add exiting player to their queue
            if (allMales.includes(exitingPlayer)) {
                maleQueue.push(exitingPlayer);
            } else if (allFemales.includes(exitingPlayer)) {
                femaleQueue.push(exitingPlayer);
            }

            // Shift all players clockwise
            for (let i = 5; i > 0; i--) {
                court[i] = court[i - 1];
            }

            // Find next player to enter from the correct queue
            let enteringPlayer = '';
            if (allMales.includes(exitingPlayer)) {
                // Male rotates off, male rotates on
                enteringPlayer = maleQueue.shift();
            } else {
                // Female rotates off, female rotates on
                enteringPlayer = femaleQueue.shift();
            }
            court[0] = enteringPlayer;

            rotationCount++;
            // Log the rotation
            const log = document.getElementById('rotationLog');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>Rotation ${rotationCount}:</strong> ${exitingPlayer} exits pos 6 → ${enteringPlayer} enters pos 1`;
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
            
            updateDisplay();
        }
        
        function areAdjacent(arr, name1, name2) {
            const n = arr.length;
            for (let i = 0; i < n; i++) {
                if (
                    (arr[i] === name1 && arr[(i + 1) % n] === name2) ||
                    (arr[i] === name2 && arr[(i + 1) % n] === name1)
                ) {
                    return true;
                }
            }
            return false;
        }

        function isAlternatingGender(arr, males, females) {
            for (let i = 0; i < arr.length; i++) {
                const curr = arr[i];
                const next = arr[(i + 1) % arr.length];
                if (
                    (males.includes(curr) && males.includes(next)) ||
                    (females.includes(curr) && females.includes(next))
                ) {
                    return false;
                }
            }
            return true;
        }

        function* permute(arr, l = 0) {
            if (l === arr.length - 1) yield arr.slice();
            else {
                for (let i = l; i < arr.length; i++) {
                    [arr[l], arr[i]] = [arr[i], arr[l]];
                    yield* permute(arr, l + 1);
                    [arr[l], arr[i]] = [arr[i], arr[l]];
                }
            }
        }

        function reset() {
            // Exception: Only 2 females, keep them always on court, ignore alternation
            if (allFemales.length === 2) {
                // Place both females in any two positions, fill rest with males
                let femalesOnCourt = allFemales.slice();
                let malesOnCourt = allMales.slice(0, 4);
                let courtPlayers = [];
                // Place females at positions 2 and 5 for some spread
                courtPlayers[1] = femalesOnCourt[0];
                courtPlayers[4] = femalesOnCourt[1];
                let m = 0;
                for (let i = 0; i < 6; i++) {
                    if (!courtPlayers[i]) {
                        courtPlayers[i] = malesOnCourt[m++] || '';
                    }
                }
                court = courtPlayers;
                maleQueue = allMales.filter(name => !court.includes(name));
                femaleQueue = []; // always on court
                rotationCount = 0;
                if (autoRotateInterval) {
                    clearInterval(autoRotateInterval);
                    autoRotateInterval = null;
                    document.getElementById('autoBtn').textContent = 'Auto Rotate';
                }
                document.getElementById('rotationLog').innerHTML = '';
                updateDisplay();
                return;
            }

            // Normal case: try to alternate gender, then avoid Tonya/Ross, then Ben/Bridget
            const malesOnCourt = allMales.slice(0, 3);
            const femalesOnCourt = allFemales.slice(0, 3);
            let allPlayers = [...malesOnCourt, ...femalesOnCourt];

            // Try all permutations for best fit
            let best = null;
            for (const perm of permute(allPlayers)) {
                if (
                    isAlternatingGender(perm, allMales, allFemales) &&
                    !areAdjacent(perm, 'Tonya', 'Ross') &&
                    !areAdjacent(perm, 'Ben', 'Bridget')
                ) {
                    best = perm;
                    break;
                }
            }
            if (!best) {
                // Try to alternate gender and avoid Tonya/Ross
                for (const perm of permute(allPlayers)) {
                    if (
                        isAlternatingGender(perm, allMales, allFemales) &&
                        !areAdjacent(perm, 'Tonya', 'Ross')
                    ) {
                        best = perm;
                        break;
                    }
                }
            }
            if (!best) {
                // Try to alternate gender only
                for (const perm of permute(allPlayers)) {
                    if (isAlternatingGender(perm, allMales, allFemales)) {
                        best = perm;
                        break;
                    }
                }
            }
            if (!best) {
                // Try to avoid Tonya/Ross, then Ben/Bridget
                for (const perm of permute(allPlayers)) {
                    if (
                        !areAdjacent(perm, 'Tonya', 'Ross') &&
                        !areAdjacent(perm, 'Ben', 'Bridget')
                    ) {
                        best = perm;
                        break;
                    }
                }
            }
            if (!best) {
                // Try to avoid Tonya/Ross only
                for (const perm of permute(allPlayers)) {
                    if (!areAdjacent(perm, 'Tonya', 'Ross')) {
                        best = perm;
                        break;
                    }
                }
            }
            if (!best) {
                // Fallback: any order
                best = allPlayers;
            }

            // Fill up to 6 positions, pad with empty if needed
            while (best.length < 6) best.push('');
            court = best;

            // Rebuild queues with remaining players
            maleQueue = allMales.filter(name => !court.includes(name));
            femaleQueue = allFemales.filter(name => !court.includes(name));

            rotationCount = 0;

            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
                autoRotateInterval = null;
                document.getElementById('autoBtn').textContent = 'Auto Rotate';
            }

            document.getElementById('rotationLog').innerHTML = '';
            updateDisplay();
        }
        
        function autoRotate() {
            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
                autoRotateInterval = null;
                document.getElementById('autoBtn').textContent = 'Auto Rotate';
            } else {
                autoRotateInterval = setInterval(rotateOnce, 2000);
                document.getElementById('autoBtn').textContent = 'Stop Auto';
            }
        }
        
        // Render the player list with remove buttons
        function renderPlayerList() {
            const playerListDiv = document.getElementById('playerList');
            playerListDiv.innerHTML = '';

            // Combine and show all players
            const allPlayers = [...allMales, ...allFemales];
            allPlayers.forEach(name => {
                const gender = allMales.includes(name) ? 'Male' : 'Female';
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.alignItems = 'center';
                div.style.justifyContent = 'space-between';
                div.style.margin = '4px 0';

                const label = document.createElement('span');
                label.textContent = `${name} (${gender})`;

                const btn = document.createElement('button');
                btn.textContent = 'Remove';
                btn.className = 'btn secondary';
                btn.style.padding = '4px 10px';
                btn.style.fontSize = '13px';
                btn.onclick = function() { removePlayer(name); };

                div.appendChild(label);
                div.appendChild(btn);
                playerListDiv.appendChild(div);
            });
        }

        // Remove player from all lists and update display
        function removePlayer(name) {
            // Remove from allMales/allFemales arrays
            allMales = allMales.filter(m => m !== name);
            allFemales = allFemales.filter(f => f !== name);

            // Remove from rotation orders
            maleRotationOrder = maleRotationOrder.filter(m => m !== name);
            femaleRotationOrder = femaleRotationOrder.filter(f => f !== name);

            // Remove from queues
            maleQueue = maleQueue.filter(m => m !== name);
            femaleQueue = femaleQueue.filter(f => f !== name);

            // Remove from court
            let courtIdx = court.indexOf(name);
            if (courtIdx !== -1) {
                court[courtIdx] = '';
            }

            // Reset and reapply rotation logic
            reset();
            renderPlayerList();
            updateDisplay();
        }

        // Add player (existing logic, now calls renderPlayerList)
        function addPlayer() {
            const name = document.getElementById('newPlayerName').value.trim();
            const gender = document.getElementById('newPlayerGender').value;
            if (!name) return;

            if (allMales.includes(name) || allFemales.includes(name)) {
                alert('Player already exists.');
                return;
            }

            if (gender === 'male') {
                allMales = [...allMales, name];
                maleRotationOrder = [...maleRotationOrder, name];
            } else {
                allFemales = [...allFemales, name];
                femaleRotationOrder = [...femaleRotationOrder, name];
            }
            document.getElementById('newPlayerName').value = '';
            
            renderPlayerList();
            updateDisplay();
        }

        // Initialize display and optimize on load
        function initialize() {
            updateDisplay();
            renderPlayerList();
        }
        
        // Call initialize when page loads
        initialize();
    </script>
</body>
</html>
